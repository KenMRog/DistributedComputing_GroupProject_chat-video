server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: screenshare-backend
  
  profiles:
    # Default to production so the application uses Azure SQL by default
    # To override, set SPRING_PROFILES_ACTIVE env var locally.
    active: ${SPRING_PROFILES_ACTIVE:production}
  
  datasource:
    url: ${DB_URL:jdbc:h2:mem:testdb}
    driver-class-name: ${DB_DRIVER:org.h2.Driver}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:password}
  
  h2:
    console:
      enabled: ${H2_CONSOLE_ENABLED:true}
      path: /h2-console
  
  jpa:
    database-platform: ${JPA_DIALECT:org.hibernate.dialect.H2Dialect}
    hibernate:
      ddl-auto: ${HIBERNATE_DDL_AUTO:update}
    show-sql: ${SHOW_SQL:true}
    properties:
      hibernate:
        format_sql: true
        jdbc:
          time_zone: UTC
  
  websocket:
    allowed-origins: ${ALLOWED_ORIGINS:http://localhost:3000}

# Azure Configuration
azure:
  servicebus:
    connection-string: ${AZURE_SERVICEBUS_CONNECTION_STRING:}
    queue-name: ${AZURE_SERVICEBUS_QUEUE_NAME:screenshare-queue}
    topic-name: ${AZURE_SERVICEBUS_TOPIC_NAME:screenshare-topic}
  storage:
    connection-string: ${AZURE_STORAGE_CONNECTION_STRING:}
    container-name: ${AZURE_STORAGE_CONTAINER_NAME:screenshare-files}
  sql:
    server: ${AZURE_SQL_SERVER:screen-share.database.windows.net}
    database: ${AZURE_SQL_DATABASE:CMPS-432}
    username: ${AZURE_SQL_USERNAME:Screen-Share-Admin}
    password: ${AZURE_SQL_PASSWORD:}

---
# Production Profile (Azure SQL Server)
spring:
  config:
    activate:
      on-profile: production
  
  datasource:
    url: jdbc:sqlserver://${azure.sql.server}:1433;database=${azure.sql.database};encrypt=true;trustServerCertificate=false;loginTimeout=30;
    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver
    username: ${azure.sql.username}
    password: ${azure.sql.password}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  h2:
    console:
      enabled: false
  
  jpa:
    database-platform: org.hibernate.dialect.SQLServerDialect
    hibernate:
      ddl-auto: update
    show-sql: false

---
# Development Profile (H2)
spring:
  config:
    activate:
      on-profile: dev
  
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password: password
  
  h2:
    console:
      enabled: true
  
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: true

# Azure Configuration (optional - only used if credentials are provided)
#azure:
#  servicebus:
#    connection-string: ${AZURE_SERVICEBUS_CONNECTION_STRING}
#    queue-name: ${AZURE_SERVICEBUS_QUEUE_NAME:helloworld-queue}
#    topic-name: ${AZURE_SERVICEBUS_TOPIC_NAME:helloworld-topic}
#    subscription-name: ${AZURE_SERVICEBUS_SUBSCRIPTION_NAME:helloworld-subscription}
#  eventgrid:
#    endpoint: ${AZURE_EVENTGRID_ENDPOINT}
#    key: ${AZURE_EVENTGRID_KEY}
#    topic-endpoint: ${AZURE_EVENTGRID_TOPIC_ENDPOINT:}

# Logging
logging:
  level:
    com.screenshare: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql: TRACE
    org.springframework.orm.jpa: DEBUG
